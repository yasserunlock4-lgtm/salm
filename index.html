<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø³Ø§Ù„Ù… Ø¯Ø¹Ø¨ÙˆÙ„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        .packet-animation:active { transform: scale(0.9); }
        .gradient-bg { background: linear-gradient(180deg, #020617 0%, #0f172a 100%); }
        .nav-active { color: #f59e0b; background: rgba(245, 158, 11, 0.1); }
        .hidden { display: none; }
    </style>
</head>
<body class="gradient-bg min-h-screen text-slate-100 pb-28">

    <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="loading-screen" class="fixed inset-0 z-[100] bg-slate-950 flex items-center justify-center">
        <div class="text-center">
            <div class="w-16 h-16 border-4 border-amber-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="font-bold text-amber-500">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
        </div>
    </div>

    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± (Ø§Ù„Ø±ØµÙŠØ¯ ÙˆØ§Ù„Ù…Ø¤Ù‚Øª) -->
    <header class="p-4 max-w-md mx-auto flex justify-between items-center mt-2">
        <div class="bg-slate-900 rounded-2xl px-5 py-2 border border-green-500/20 shadow-xl flex flex-col items-center">
            <span class="text-[10px] text-slate-400 font-bold">Ø§Ù„Ø±ØµÙŠØ¯</span>
            <span id="balance-display" class="font-black text-green-500 text-lg">0.00$</span>
        </div>
        <div class="bg-slate-900 rounded-2xl px-5 py-2 border border-blue-500/20 shadow-xl flex flex-col items-center">
            <span class="text-[10px] text-slate-400 font-bold">Ø§Ù„Ù…Ø¤Ù‚Øª</span>
            <span id="timer-display" class="font-black text-blue-400 text-lg">Ù…ØªØ§Ø­</span>
        </div>
    </header>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Home) -->
    <main id="section-home" class="max-w-md mx-auto flex flex-col items-center p-4 animate-in fade-in">
        <img src="https://i.ibb.co/3yxmRCHd/1000124039.jpg" class="w-24 h-24 rounded-full border-4 border-amber-500 shadow-2xl mb-4" alt="Ø³Ø§Ù„Ù… Ø¯Ø¹Ø¨ÙˆÙ„">
        <h1 class="text-2xl font-black text-amber-500 mb-1">Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø³Ø§Ù„Ù… Ø¯Ø¹Ø¨ÙˆÙ„</h1>
        <p class="text-[10px] text-slate-400 mb-10 text-center">Ø§ÙØªØ­ Ø§Ù„ÙƒÙŠØ³ ÙƒÙ„ 10 Ø¯Ù‚Ø§Ø¦Ù‚ ÙˆØ§Ø¬Ù…Ø¹ Ø§Ù„Ø³Ù†ØªØ§Øª</p>

        <!-- ÙƒÙŠØ³ Ø§Ù„Ø¬Ø¨Ø³ -->
        <div id="open-packet-btn" class="cursor-pointer transition-all duration-300 packet-animation hover:scale-105">
            <div class="w-40 h-52 bg-gradient-to-b from-amber-800 to-amber-950 border-4 border-amber-500 rounded-[2.5rem] flex flex-col items-center justify-center shadow-2xl relative">
                <div class="absolute top-0 w-full h-8 bg-amber-700/30 rounded-t-[2.1rem]"></div>
                <span class="text-4xl font-black text-amber-500">Ø¬Ø¨Ø³</span>
            </div>
        </div>

        <button id="main-action-btn" class="mt-10 w-full bg-amber-500 text-slate-950 py-4 rounded-2xl font-black text-xl shadow-lg active:scale-95 transition-all">
            Ø§ÙØªØ­ Ø§Ù„ÙƒÙŠØ³ Ø§Ù„Ø¢Ù†
        </button>
    </main>

    <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ù‡Ø§Ù… -->
    <section id="section-tasks" class="max-w-md mx-auto p-4 hidden animate-in slide-in-from-bottom-5">
        <h2 class="text-2xl font-black mb-6 text-center text-amber-500">Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ù‡Ø§Ù…</h2>
        <div id="tasks-container" class="space-y-4">
            <!-- Ø§Ù„Ù…Ù‡Ø§Ù… ØªØ¶Ø§Ù Ù‡Ù†Ø§ Ø¹Ø¨Ø± JS -->
        </div>
    </section>

    <!-- Ù‚Ø³Ù… Ø§Ù„Ø³Ø­Ø¨ (Store) -->
    <section id="section-store" class="max-w-md mx-auto p-4 hidden animate-in slide-in-from-bottom-5">
        <h2 class="text-2xl font-black mb-2 text-center text-green-500">Ø·Ù„Ø¨ Ø³Ø­Ø¨</h2>
        <p class="text-center text-xs text-slate-400 mb-8 font-bold">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø­Ø¨: 500.00$</p>
        <div id="store-container" class="space-y-4">
            <!-- Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ØªØ¬Ø± ØªØ¶Ø§Ù Ù‡Ù†Ø§ Ø¹Ø¨Ø± JS -->
        </div>
    </section>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© (Popup) -->
    <div id="prize-modal" class="fixed inset-0 z-[200] bg-black/95 flex items-center justify-center p-6 hidden">
        <div class="bg-slate-900 border-2 border-amber-500 p-10 rounded-[3rem] text-center max-w-xs w-full shadow-2xl">
            <div id="modal-icon" class="text-7xl mb-6">ğŸª™</div>
            <h2 id="modal-status" class="text-xl font-black text-white mb-2">Ù…Ø¨Ø±ÙˆÙƒ!</h2>
            <p id="modal-prize-name" class="text-4xl font-black text-amber-500 mb-8">0.05$</p>
            <button onclick="closeModal()" class="w-full bg-amber-500 text-black py-4 rounded-2xl font-black">Ø§Ø³ØªÙ…Ø±Ø§Ø±</button>
        </div>
    </div>

    <!-- Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ -->
    <nav class="fixed bottom-6 left-6 right-6 bg-slate-900/90 backdrop-blur-xl border border-white/10 rounded-[2.5rem] p-2 flex justify-around shadow-2xl z-50">
        <button onclick="showSection('home')" id="nav-home" class="flex flex-col items-center p-3 rounded-2xl nav-active transition-all">
            <span class="text-xl">ğŸ </span>
            <span class="text-[10px] font-bold">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </button>
        <button onclick="showSection('tasks')" id="nav-tasks" class="flex flex-col items-center p-3 rounded-2xl text-slate-500 transition-all">
            <span class="text-xl">ğŸ“‹</span>
            <span class="text-[10px] font-bold">Ø§Ù„Ù…Ù‡Ø§Ù…</span>
        </button>
        <button onclick="showSection('store')" id="nav-store" class="flex flex-col items-center p-3 rounded-2xl text-slate-500 transition-all">
            <span class="text-xl">ğŸ’µ</span>
            <span class="text-[10px] font-bold">Ø§Ù„Ø³Ø­Ø¨</span>
        </button>
    </nav>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³
        const firebaseConfig = JSON.parse(window.__firebase_config || '{}');
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = window.__app_id || 'salem-daaboul-app';

        // Ø«ÙˆØ§Ø¨Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        const COOLDOWN = 10 * 60 * 1000;
        const MIN_WITHDRAW = 500.00;
        const PRIZES = [
            { name: "0.01$", val: 0.01, icon: "ğŸª™" },
            { name: "0.05$", val: 0.05, icon: "ğŸ’µ" },
            { name: "0.10$", val: 0.10, icon: "ğŸ’°" },
            { name: "Ø­Ø¸ Ø£ÙˆÙØ±", val: 0, icon: "ğŸ˜…" },
            { name: "Ø­Ø¸ Ø£ÙˆÙØ±", val: 0, icon: "ğŸ‚" }
        ];

        const TASKS = [
            { id: 'tg', name: 'Ù‚Ù†Ø§Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…', bonus: 0.50, icon: 'ğŸ“¢', url: 'https://t.me/your_channel' },
            { id: 'ig', name: 'Ø¥Ù†Ø³ØªÙ‚Ø±Ø§Ù… Ø³Ø§Ù„Ù…', bonus: 0.25, icon: 'ğŸ“¸', url: 'https://instagram.com/your_account' }
        ];

        const STORE = [
            { id: 'asia', name: 'Ø±ØµÙŠØ¯ Ø¢Ø³ÙŠØ§ Ø³ÙŠÙ„', price: 500, icon: 'ğŸ“²' },
            { id: 'zain', name: 'Ø±ØµÙŠØ¯ Ø²ÙŠÙ† Ø§Ù„Ø¹Ø±Ø§Ù‚', price: 500, icon: 'ğŸ“±' },
            { id: 'cash', name: 'Ø³Ø­Ø¨ ÙƒØ§Ø´ Ù„Ù„Ø¹Ù†ÙˆØ§Ù†', price: 500, icon: 'ğŸ ' }
        ];

        let currentUser = null;
        let userData = { balance: 0, lastOpenTime: 0, completedTasks: [] };

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        signInAnonymously(auth).catch(console.error);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                const userRef = doc(db, 'artifacts', appId, 'users', user.uid);
                
                // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ø±ØµÙŠØ¯
                onSnapshot(userRef, (docSnap) => {
                    if (docSnap.exists()) {
                        userData = docSnap.data();
                        updateUI();
                        document.getElementById('loading-screen').classList.add('hidden');
                    } else {
                        setDoc(userRef, { balance: 0, lastOpenTime: 0, completedTasks: [], uid: user.uid });
                    }
                });
            }
        });

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        function updateUI() {
            document.getElementById('balance-display').innerText = `${(userData.balance || 0).toFixed(2)}$`;
            renderTasks();
            renderStore();
            checkTimer();
        }

        // Ø§Ù„Ù…Ø¤Ù‚Øª
        function checkTimer() {
            const now = Date.now();
            const diff = now - (userData.lastOpenTime || 0);
            const remaining = Math.max(0, COOLDOWN - diff);
            const btn = document.getElementById('main-action-btn');
            const packet = document.getElementById('open-packet-btn');

            if (remaining > 0) {
                const mins = Math.floor(remaining / 60000);
                const secs = Math.floor((remaining % 60000) / 1000);
                const timeStr = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
                document.getElementById('timer-display').innerText = timeStr;
                document.getElementById('timer-display').className = "font-black text-blue-400 text-lg";
                btn.innerText = `Ø§Ù†ØªØ¸Ø± ${timeStr}`;
                btn.classList.replace('bg-amber-500', 'bg-slate-800');
                btn.classList.add('text-slate-500');
                packet.style.opacity = "0.4";
                packet.style.pointerEvents = "none";
            } else {
                document.getElementById('timer-display').innerText = "Ù…ØªØ§Ø­";
                document.getElementById('timer-display').className = "font-black text-green-400 text-lg";
                btn.innerText = "Ø§ÙØªØ­ Ø§Ù„ÙƒÙŠØ³ Ø§Ù„Ø¢Ù†";
                btn.classList.replace('bg-slate-800', 'bg-amber-500');
                btn.classList.remove('text-slate-500');
                packet.style.opacity = "1";
                packet.style.pointerEvents = "auto";
            }
        }
        setInterval(checkTimer, 1000);

        // ÙØªØ­ Ø§Ù„ÙƒÙŠØ³
        window.handleOpen = async () => {
            if (!currentUser || (Date.now() - userData.lastOpenTime < COOLDOWN)) return;
            
            const prize = PRIZES[Math.floor(Math.random() * PRIZES.length)];
            const userRef = doc(db, 'artifacts', appId, 'users', currentUser.uid);

            await updateDoc(userRef, {
                balance: increment(prize.val),
                lastOpenTime: Date.now()
            });

            showModal(prize);
        };

        document.getElementById('open-packet-btn').onclick = window.handleOpen;
        document.getElementById('main-action-btn').onclick = window.handleOpen;

        // Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©
        function showModal(prize) {
            document.getElementById('modal-icon').innerText = prize.icon;
            document.getElementById('modal-status').innerText = prize.val > 0 ? "Ù…Ø¨Ø±ÙˆÙƒ!" : "ÙŠØ§ Ù„Ù„Ø£Ø³Ù!";
            document.getElementById('modal-prize-name').innerText = prize.name;
            document.getElementById('prize-modal').classList.remove('hidden');
        }
        window.closeModal = () => document.getElementById('prize-modal').classList.add('hidden');

        // Ø±Ù†Ø¯Ø± Ø§Ù„Ù…Ù‡Ø§Ù…
        function renderTasks() {
            const container = document.getElementById('tasks-container');
            container.innerHTML = TASKS.map(t => {
                const done = userData.completedTasks?.includes(t.id);
                return `
                    <div class="bg-slate-900/50 p-4 rounded-3xl border border-white/5 flex justify-between items-center shadow-lg">
                        <div class="flex items-center gap-4">
                            <span class="text-3xl">${t.icon}</span>
                            <div>
                                <p class="font-bold text-sm">${t.name}</p>
                                <p class="text-xs text-green-500 font-bold">+${t.bonus}$</p>
                            </div>
                        </div>
                        <button onclick="doTask('${t.id}', ${t.bonus}, '${t.url}')" ${done ? 'disabled' : ''} class="px-5 py-2 rounded-xl text-[10px] font-black ${done ? 'bg-green-500/20 text-green-500' : 'bg-white text-black'}">
                            ${done ? 'ØªÙ…' : 'ØªÙ†ÙÙŠØ°'}
                        </button>
                    </div>
                `;
            }).join('');
        }

        window.doTask = async (id, bonus, url) => {
            window.open(url, '_blank');
            setTimeout(async () => {
                const userRef = doc(db, 'artifacts', appId, 'users', currentUser.uid);
                await updateDoc(userRef, {
                    balance: increment(bonus),
                    completedTasks: [...(userData.completedTasks || []), id]
                });
            }, 3000);
        };

        // Ø±Ù†Ø¯Ø± Ø§Ù„Ù…ØªØ¬Ø±
        function renderStore() {
            const container = document.getElementById('store-container');
            container.innerHTML = STORE.map(s => `
                <div class="bg-slate-900/50 p-4 rounded-3xl border border-white/5 flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <span class="text-3xl">${s.icon}</span>
                        <span class="font-bold text-sm">${s.name}</span>
                    </div>
                    <button onclick="requestWithdraw(${s.price}, '${s.name}')" class="bg-green-600 text-white px-5 py-2 rounded-xl text-[10px] font-black">
                        ${s.price}$
                    </button>
                </div>
            `).join('');
        }

        window.requestWithdraw = async (price, name) => {
            if (userData.balance < MIN_WITHDRAW) {
                alert(`Ø¹Ø°Ø±Ø§Ù‹! Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù‡Ùˆ ${userData.balance.toFixed(2)}$ØŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ${MIN_WITHDRAW}$ ÙƒØ­Ø¯ Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø­Ø¨.`);
                return;
            }
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø³Ø­Ø¨ ${price}$ØŸ`)) {
                const userRef = doc(db, 'artifacts', appId, 'users', currentUser.uid);
                await updateDoc(userRef, { balance: increment(-price) });
                alert('ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨Ùƒ! Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©.');
                window.open(`https://t.me/your_user?text=Ø·Ù„Ø¨ Ø³Ø­Ø¨: ${name} Ù…Ù† ID: ${currentUser.uid}`);
            }
        };

        // Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ù‚Ù„
        window.showSection = (name) => {
            document.querySelectorAll('main, section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`section-${name}`).classList.remove('hidden');
            
            document.querySelectorAll('nav button').forEach(b => {
                b.classList.remove('nav-active');
                b.classList.add('text-slate-500');
            });
            document.getElementById(`nav-${name}`).classList.add('nav-active');
            document.getElementById(`nav-${name}`).classList.remove('text-slate-500');
        };

    </script>
</body>
</html>
